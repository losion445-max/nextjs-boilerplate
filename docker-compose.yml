version: '3.8'

services:
	# Next.js Application
	app:
		build:
			context: .
			dockerfile: Dockerfile
		container_name: nextjs-app
		ports:
			- "3000:3000"
		environment:
			- NODE_ENV=production
			- NEXT_PUBLIC_API_URL=http://localhost:3000
		restart: unless-stopped
		networks:
			- nextjs-network
		healthcheck:
			test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000"]
			interval: 30s
			timeout: 10s
			retries: 3
			start_period: 10s

	# Optional: Nginx reverse proxy (for production)
	nginx:
		image: nginx:alpine
		container_name: nextjs-nginx
		ports:
			- "80:80"
			- "443:443"
		volumes:
			- ./nginx.conf:/etc/nginx/nginx.conf:ro
		depends_on:
			- app
		restart: unless-stopped
		networks:
			- nextjs-network
		profiles:
			- production

networks:
	nextjs-network:
		driver: bridge
